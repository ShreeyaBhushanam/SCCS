<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel='stylesheet' href='../styles/style.css' />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheets">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <title>SCCS</title>
 
</head>
<style>
    body {
        background-color: #EFF5F5;
    }

    .col:hover {
        position: relative;
        bottom: 3px;
    }

    .displaycard {
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    }

    a:link {
        text-decoration: none;
    }
</style>

<style>
    #searchfield {
        --bg: #e3e4e8;
        --fg: #17181c;
        --input: #ffffff;
        --primary: #255ff4;
        --dur: 1s;
        font-size: calc(16px + (24 - 16)*(100vw - 320px)/(1600));
        /* background: rgba(16, 166, 108, 0.184); */
        background-color: #D6E4E5;
        width: 96%;
        margin: auto;
        padding: 2px 0px;
    }

    #search {
        color: var(--fg);
        font: 1em/1.5 Hind, sans-serif;
    }

    .searchclass,
    #search,
    .caret {
        margin: auto;
    }

    .searchclass {
        position: relative;
        width: 100%;
        max-width: 17em;
    }

    #search,
    .caret {
        display: block;
        transition: all calc(var(--dur) * 0.5) linear;
    }

    #search {
        background: transparent;
        border-radius: 50%;
        box-shadow: 0 0 0 0.05em inset;
        caret-color: var(--primary);
        width: 1.5em;
        height: 1.5em;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
    }

    #search:focus,
    #search:valid {
        background: var(--input);
        border-radius: 0.05em;
        box-shadow: none;
        padding: 0.75em 1em;
        transition-duration: calc(var(--dur) * 0.25);
        transition-delay: calc(var(--dur) * 0.25);
        width: 100%;
        height: 1em;
    }

    #search:focus {
        animation: showCaret var(--dur) steps(1);
        outline: transparent;
    }

    #search:focus+.caret,
    #search:valid+.caret {
        animation: handleToCaret var(--dur) linear;
        background: transparent;
        width: 0.5px;
        height: 0.5em;
        transform: translate(0, -1em) rotate(-180deg) translate(7.5em, -0.25em);
    }

    #search::-webkit-search-decoration {
        -webkit-appearance: none;
    }

    #searchlabel {
        color: #e3e4e8;
        overflow: hidden;
        position: absolute;
        width: 0;
        height: 0;
    }

    .caret {
        background: currentColor;
        border-radius: 0 0 0.125em 0.125em;
        margin-bottom: -0.4em;
        width: 0.25em;
        height: 0.75em;
        transform: translate(0, -0.95em) rotate(-37deg) translate(0, 0.875em);
        transform-origin: 50% 0;
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark) {
        :root {
            --bg: #17181c;
            --fg: #e3e4e8;
            --input: #2e3138;
            --primary: #5583f6;
        }
    }

    /* Animations */
    @keyframes showCaret {
        from {
            caret-color: transparent;
        }

        to {
            caret-color: var(--primary);
        }
    }

    @keyframes handleToCaret {
        from {
            background: currentColor;
            width: 0.25em;
            height: 1em;
            transform: translate(0, -1em) rotate(-45deg) translate(0, 0.875em);
        }

        25% {
            background: currentColor;
            width: 0.25em;
            height: 1em;
            transform: translate(0, -1em) rotate(-180deg) translate(0, 0.875em);
        }

        50%,
        62.5% {
            background: var(--primary);
            width: 1px;
            height: 1.5em;
            transform: translate(0, -1em) rotate(-180deg) translate(7.5em, 2.5em);
        }

        75%,
        99% {
            background: var(--primary);
            width: 1px;
            height: 1.5em;
            transform: translate(0, -1em) rotate(-180deg) translate(7.5em, -0.25em);
        }

        87.5% {
            background: var(--primary);
            width: 1px;
            height: 1.5em;
            transform: translate(0, -1em) rotate(-180deg) translate(7.5em, 0.125em);
        }

        to {
            background: transparent;
            width: 1px;
            height: 1.5em;
            transform: translate(0, -1em) rotate(-180deg) translate(7.5em, -0.25em);
        }
    }
</style>
<body>

    <div class="topnav">
        <a href="/home" class="split" style="float: right;
        border:solid 1px black; border-radius: 5px;" ><b>LogOut</b></a>
    </div> 
    <h1 style="text-align: center;">All Components</h1>
    <br>
    <% if(uall.length==0){ %>
        <div class="card-footer">
            <img src="/stylesheets/empty.png" style="margin-top:10vh; height:60vh;"></img>
            <p style="font-weight:500;color: rgb(139, 138, 138);">Sorryy!!! No Services Available Right Now . Please
                Come Back Later</p>
        </div>
        <% } else{ %>
            <div id="searchfield">
                <form class="searchclass">
                    <label for="search" id="searchlabel"></label>
                    <input id="search" type="search" pattern=".*\S.*" required>
                    <span class="caret"></span>
                </form>
            </div>
            <div></div>
            <br><br>
                <div  class="p-3 m-lg-0 border-0  bd-example" id="allstoresdiv">  
                    <div class="row row-cols-1 row-cols-md-4 g-4">
                        <% for(let c of uall){ %>
                            
                            <div class="col">
                                <div class="card h-100">
                                  <div class="card-body">
                                        <h5 class="card-title" style="font-size: 22px;font-weight: 500;word-break: break-word; text-align:center;font-family: Gill Sans, sans-serif; color: #282c3f;padding-bottom: 11px;">
                                                <%= c.name %> 
                                        </h5>
                                        <br>
                                        <p class="card-text"
                                            style="font-size: 10px;font-weight: 500 ;word-break: break-word; font-family: Gill Sans, sans-serif; color: #3e3e3f;">
                                            <%= c.description %>
                                        </p>
                                    </div> 
                                    <div class="text-center" style="padding-top:10px; padding-bottom: 20px;">
                                        <a href="/usershow/<%= c.id %>" style="color:#45898e;">View More</a>
                                    </div>          
                                </div>
                            </div>
                
                            <% } %>
                    </div>
                </div>
            <% } %>

<script>

                    const uall = <%- JSON.stringify(uall) %>;

                    var root = document.getElementById('allstoresdiv');
                    const searchBar = document.getElementById('search');

                    // console.log(all);

                    searchBar.addEventListener('keyup', (e) => {
                        const searchString = e.target.value.toLowerCase();

                        const searchResults = uall.filter((character) => {
                            if (character.name.toLowerCase().includes(searchString)) 
                            {
                                return true;
                            }

                            // search in items
                            for (let c of character.items) {
                                if (c.toLowerCase().includes(searchString)) 
                                {
                                    console.log(c);
                                    return true;
                                }
                            }

                            return false;
                        });

                        console.log("Search Results");
                        console.log(searchResults);
                        displayCharacters(searchResults);
                    })

                    const displayCharacters = (characters) => {
                        if (characters.length === 0) {
                            root.innerHTML = `
                                <div class="py-3">
                                    <h3>No results have been found &#9785;</h3>
                                </div>`;
                            return 0;
                        };

                        const htmlString = characters
                            .map((character) => {

                                var c = character;

                                return `<div class="col">
                                <div class="card h-100">
                                  <div class="card-body">
                                        <h5 class="card-title" style="font-size: 22px;font-weight: 500;text-align:center;word-break: break-word; font-family: Gill Sans, sans-serif; color: #282c3f; padding-bottom:11px;">
                                                 ${c.name}
                                        </h5>
                                        <br>
                                        <p class="card-text"
                                            style="font-size: 10px;font-weight: 500 ;word-break: break-word; font-family: Gill Sans, sans-serif; color: #3e3e3f;">
                                            ${c.description}
                                        </p>
                                    </div> 
                                    <div class="text-center" style="padding-top:10px; padding-bottom: 20px;">
                                        <a href="/show/${ c.id }" style="color:#45898e;">View More</a>
                                    </div>          
                                </div>
                            </div>`
                            })
                            .join('');

                 root.innerHTML = `<div class="container my-4" id="allstoresdiv">
                <div class="row row-cols-1 row-cols-md-4 g-4">` + htmlString + `</div></div>`;


                    };

</script>
</body>
</html>